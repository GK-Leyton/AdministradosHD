-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Servidor: 127.0.0.1
-- Tiempo de generación: 19-12-2024 a las 22:11:55
-- Versión del servidor: 10.4.32-MariaDB
-- Versión de PHP: 8.0.30

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Base de datos: `administradordeudas`
--

DELIMITER $$
--
-- Procedimientos
--
CREATE DEFINER=`root`@`localhost` PROCEDURE `actualizar_interes_manual` ()   BEGIN
    UPDATE deudas
    SET
        fecha_ultimo_interes = CURDATE(),
        interes = interes + ((valor_actual * (porcentaje_interes/30)) / 100)
    WHERE
        estado = 1 AND
        porcentaje_interes > 0;
END$$

DELIMITER ;

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `deudas`
--

CREATE TABLE `deudas` (
  `id_deuda` int(11) NOT NULL,
  `valor_inicial` decimal(9,3) DEFAULT NULL,
  `porcentaje_interes` decimal(10,0) NOT NULL,
  `id_usuario` int(11) NOT NULL,
  `interes` decimal(9,3) DEFAULT NULL,
  `fecha_ultimo_interes` date NOT NULL,
  `credencial_usuario` varchar(30) NOT NULL,
  `fecha_inicial` date DEFAULT NULL,
  `valor_actual` decimal(9,3) DEFAULT NULL,
  `estado` int(11) DEFAULT NULL,
  `comprovante_deuda` varchar(40) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Volcado de datos para la tabla `deudas`
--

INSERT INTO `deudas` (`id_deuda`, `valor_inicial`, `porcentaje_interes`, `id_usuario`, `interes`, `fecha_ultimo_interes`, `credencial_usuario`, `fecha_inicial`, `valor_actual`, `estado`, `comprovante_deuda`) VALUES
(1, 200000.000, 8, 5, 204343.297, '2024-12-19', 'Anlly', '2020-12-15', 140000.000, 1, NULL),
(2, 47000.000, 8, 5, 108131.297, '2024-12-19', 'Anlly', '2021-08-07', 47000.000, 1, NULL),
(3, 100000.000, 8, 5, 186816.703, '2024-12-19', 'Anlly', '2021-11-03', 100000.000, 1, NULL),
(4, 320000.000, 10, 5, 356900.036, '2024-12-19', 'Anlly', '2024-01-16', 320000.000, 1, NULL),
(5, 45800.000, 10, 5, 51601.369, '2024-12-19', 'Anlly', '2024-02-14', 45800.000, 1, NULL),
(7, 100000.000, 10, 6, 116999.963, '2024-12-19', 'Edwin Leyton', '2023-11-06', 100000.000, 1, NULL),
(8, 175000.000, 10, 6, 234499.964, '2024-12-19', 'Edwin Leyton', '2023-12-10', 175000.000, 1, NULL),
(9, 250000.000, 10, 6, 291666.640, '2024-12-19', 'Edwin Leyton', '2024-01-03', 250000.000, 1, NULL),
(10, 200000.000, 10, 6, 244000.036, '2024-12-19', 'Edwin Leyton', '2024-01-16', 200000.000, 1, NULL),
(11, 150000.000, 10, 6, 171000.000, '2024-12-19', 'Edwin Leyton', '2021-01-10', 150000.000, 1, NULL),
(12, 150000.000, 10, 6, 168500.000, '2024-12-19', 'Edwin Leyton', '2021-02-15', 150000.000, 1, NULL),
(13, 200000.000, 10, 6, 198333.370, '2024-12-19', 'Edwin Leyton', '2021-02-17', 200000.000, 1, NULL),
(14, 120000.000, 10, 6, 96000.000, '2024-12-19', 'Edwin Leyton', '2021-04-23', 120000.000, 1, NULL),
(15, 250000.000, 10, 6, 199999.964, '2024-12-19', 'Edwin Leyton', '2021-04-23', 250000.000, 1, NULL),
(16, 100000.000, 10, 6, 0.000, '2024-06-23', 'Edwin Leyton', '2021-06-23', 0.000, 0, NULL),
(17, 55000.000, 10, 7, 0.000, '0000-00-00', 'AshleyL', '0000-00-00', 0.000, 0, NULL),
(18, 7000.000, 10, 7, 0.000, '0000-00-00', 'AshleyL', '0000-00-00', 0.000, 0, NULL),
(19, 165000.000, 10, 7, 0.000, '0000-00-00', 'AshleyL', '0000-00-00', 0.000, 0, NULL),
(20, 33000.000, 10, 7, 0.000, '0000-00-00', 'AshleyL', '0000-00-00', 0.000, 0, NULL),
(21, 77000.000, 10, 7, 0.000, '0000-00-00', 'AshleyL', '0000-00-00', 0.000, 0, NULL),
(22, 250000.000, 0, 8, 0.000, '0000-00-00', 'OfeliaM', '0000-00-00', 50000.000, 1, NULL),
(31, 30000.000, 10, 8, 0.000, '2024-06-29', 'OfeliaM', '2024-06-29', 0.000, 0, NULL),
(33, 11000.000, 0, 5, 0.000, '2024-06-29', 'Anlly', '2024-06-29', 0.000, 0, NULL),
(40, 11000.000, 0, 10, 0.000, '2024-06-30', 'Marlon', '2024-06-30', 0.000, 0, NULL),
(44, 3000.000, 0, 10, 0.000, '0000-00-00', 'Marlon', '0000-00-00', 0.000, 0, NULL),
(45, 45000.000, 0, 10, 0.000, '0000-00-00', 'Marlon', '0000-00-00', 8000.000, 1, NULL),
(46, 50000.000, 10, 10, 54000.036, '2024-12-19', 'Marlon', '2023-01-29', 50000.000, 1, NULL),
(47, 220000.000, 10, 10, 247399.964, '2024-12-19', 'Marlon', '2023-02-02', 220000.000, 1, NULL),
(48, 40000.000, 10, 10, 39599.963, '2024-12-19', 'Marlon', '2023-02-26', 40000.000, 1, NULL),
(49, 140000.000, 10, 10, 124600.036, '2024-12-19', 'Marlon', '2023-02-26', 140000.000, 1, NULL),
(54, 11000.000, 0, 7, 0.000, '2024-07-10', 'AshleyL', '2024-07-10', 0.000, 0, NULL),
(55, 55000.000, 0, 10, 0.000, '2024-07-12', 'Marlon', '2024-07-12', 55000.000, 1, NULL),
(76, 50.000, 10, 3, 0.000, '2024-07-15', 'Heider', '2024-07-15', 0.000, 0, 'Deuda6695a1ddd3389'),
(77, 330000.000, 0, 6, 0.000, '2024-07-17', 'Edwin Leyton ', '2024-07-17', 81000.000, 1, 'Deuda6698616e8b866'),
(78, 350000.000, 10, 22, 375666.703, '2024-12-19', 'Karen', '2024-01-31', 350000.000, 1, NULL),
(79, 50000.000, 10, 6, 23166.703, '2024-12-19', 'Edwin Leyton ', '2024-07-21', 50000.000, 1, 'Deuda669da2217f9d7'),
(80, 13200.000, 0, 7, 0.000, '2024-07-23', 'AshleyL', '2024-07-23', 0.000, 0, 'Deuda669ff8bc7b549'),
(103, 5500.000, 0, 5, 0.000, '2024-07-27', 'Anlly', '2024-07-27', 0.000, 0, 'Deuda66a524f71244b'),
(104, 22000.000, 0, 5, 0.000, '2024-07-27', 'Anlly', '2024-07-27', 0.000, 0, 'Deuda66a525073c638'),
(105, 16500.000, 0, 5, 0.000, '2024-07-27', 'Anlly', '2024-07-27', 0.000, 0, 'Deuda66a5271fe5862'),
(106, 50.000, 10, 3, 0.000, '2024-07-27', 'Heider', '2024-07-27', 0.000, 0, 'Deuda66a5298c5ea2e'),
(107, 33000.000, 0, 7, 0.000, '2024-07-27', 'AshleyL', '2024-07-27', 0.000, 0, 'Deuda66a54afeaaf1c'),
(108, 11000.000, 0, 7, 0.000, '2024-07-27', 'AshleyL', '2024-07-27', 0.000, 0, 'Deuda66a54b40a8db9'),
(113, 7700.000, 0, 8, 0.000, '2024-07-31', 'OfeliaM', '2024-07-31', 7700.000, 1, 'Deuda66aac8dd5a865'),
(114, 1000.000, 10, 3, 109.000, '2024-12-19', 'Heider', '2024-08-15', 300.000, 1, ''),
(115, 22000.000, 0, 6, 0.000, '2024-08-19', 'Edwin Leyton ', '2024-08-19', 0.000, 0, 'Deuda66c3c1fe89570'),
(116, 176770.000, 0, 7, 0.000, '2024-09-02', 'AshleyL', '2024-09-02', 0.000, 0, 'Deuda66d63ee04c06c'),
(117, 24200.000, 0, 5, 0.000, '2024-09-08', 'Anlly', '2024-09-08', 0.000, 0, 'Deuda66de16858e836'),
(118, 11000.000, 0, 7, 0.000, '2024-09-12', 'AshleyL', '2024-09-12', 0.000, 0, 'Deuda66e373abc0e4f'),
(119, 165440.000, 0, 10, 0.000, '2024-09-14', 'Marlon', '2024-09-14', 165440.000, 1, 'Deuda66e60ff2d4915'),
(120, 312565.000, 0, 5, 0.000, '2024-09-18', 'Anlly', '2024-09-18', 152600.000, 1, 'Deuda66eba7fe94c44'),
(122, 119900.000, 0, 7, 0.000, '2024-09-25', 'AshleyL', '2024-09-25', 0.000, 0, 'Deuda66f45b41969ac'),
(123, 77000.000, 0, 7, 0.000, '2024-10-23', 'AshleyL', '2024-10-23', 0.000, 0, 'Deuda67199a1be14fa'),
(124, 66000.000, 0, 7, 0.000, '2024-11-03', 'AshleyL', '2024-11-03', 0.000, 0, 'Deuda672781a993d2b'),
(125, 275000.000, 0, 10, 0.000, '2024-11-18', 'Marlon', '2024-11-18', 275000.000, 1, 'Deuda673bc2a616636'),
(126, 1100.000, 0, 7, 0.000, '2024-11-21', 'AshleyL', '2024-11-21', 0.000, 0, 'Deuda673f884431a06'),
(127, 30000.000, 10, 7, 0.000, '2024-12-05', 'AshleyL', '2024-12-02', 0.000, 0, 'Deuda674e5d72906f5'),
(128, 22000.000, 0, 7, 0.000, '2024-12-04', 'AshleyL', '2024-12-04', 0.000, 0, 'Deuda6750a4d3cde89'),
(129, 132000.000, 0, 10, 0.000, '2024-12-09', 'Marlon', '2024-12-09', 122000.000, 1, 'Deuda675798c8eb9a7'),
(130, 16000.000, 10, 10, 159.999, '2024-12-19', 'Marlon', '2024-12-16', 16000.000, 1, 'Deuda6760dba83b60b');

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `ganancias`
--

CREATE TABLE `ganancias` (
  `id_ganancia` int(11) NOT NULL,
  `ganancia_del_dia` decimal(12,4) DEFAULT NULL,
  `ganancia_diferencia` decimal(10,0) NOT NULL,
  `fecha` date DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Volcado de datos para la tabla `ganancias`
--

INSERT INTO `ganancias` (`id_ganancia`, `ganancia_del_dia`, `ganancia_diferencia`, `fecha`) VALUES
(405, 2450756.6700, 2450757, '2024-09-06'),
(9792, 2460059.0000, 9302, '2024-09-07'),
(58893, 2469361.3400, 9302, '2024-09-08'),
(58939, 2478663.6700, 9302, '2024-09-09'),
(58946, 2487966.0000, 9302, '2024-09-10'),
(58951, 2497268.3400, 9302, '2024-09-11'),
(58970, 2506570.6700, 9302, '2024-09-12'),
(59024, 2515873.0100, 9302, '2024-09-13'),
(59029, 2525175.3400, 9302, '2024-09-14'),
(59038, 2534477.6700, 9302, '2024-09-15'),
(59053, 2534477.6700, 9302, '2024-09-16'),
(59062, 2543780.0100, 9302, '2024-09-17'),
(59079, 2562384.6800, 9302, '2024-09-18'),
(59092, 2562384.6800, 9302, '2024-09-19'),
(59098, 2571687.0100, 9302, '2024-09-20'),
(59107, 2590291.6800, 9302, '2024-09-21'),
(59121, 2590291.6800, 9302, '2024-09-22'),
(59135, 2599594.0100, 9302, '2024-09-23'),
(59143, 2608896.3500, 9302, '2024-09-24'),
(59153, 2627501.0100, 9302, '2024-09-25'),
(59167, 2627501.0100, 9302, '2024-09-26'),
(59179, 2636803.3500, 9302, '2024-09-27'),
(59181, 2655408.0200, 9302, '2024-09-28'),
(59188, 2655408.0200, 9302, '2024-09-29'),
(59194, 2674012.6800, 9302, '2024-09-30'),
(59203, 2674012.6800, 0, '2024-10-01'),
(59211, 2683315.0200, 9302, '2024-10-02'),
(59222, 2702753.0200, 19438, '2024-10-03'),
(59230, 2702753.0200, 0, '2024-10-04'),
(59233, 2723024.3500, 20271, '2024-10-05'),
(59247, 2733160.0200, 10136, '2024-10-06'),
(59261, 2743295.6900, 10136, '2024-10-07'),
(59271, 2753431.3500, 10136, '2024-10-08'),
(59283, 2753431.3500, 0, '2024-10-09'),
(59294, 2773702.6900, 20271, '2024-10-10'),
(59304, 2783838.3500, 10136, '2024-10-11'),
(59318, 2783838.3500, 0, '2024-10-12'),
(59333, 2804109.6900, 20271, '2024-10-13'),
(59344, 2814245.3600, 10136, '2024-10-14'),
(59358, 2814245.3600, 0, '2024-10-15'),
(59366, 2834516.6900, 20271, '2024-10-16'),
(59382, 2834516.6900, 0, '2024-10-17'),
(59398, 2854788.0200, 20271, '2024-10-18'),
(59407, 2864923.6900, 10136, '2024-10-20'),
(59421, 2885195.0200, 20271, '2024-10-21'),
(59427, 2895330.6900, 10136, '2024-10-22'),
(59433, 2905466.3600, 10136, '2024-10-23'),
(59445, 2915602.0300, 10136, '2024-10-24'),
(59451, 2915602.0300, 0, '2024-10-26'),
(59457, 2946009.0300, 30407, '2024-10-27'),
(59470, 2956144.6900, 10136, '2024-10-28'),
(59474, 2956144.6900, 0, '2024-10-29'),
(59482, 2966280.3600, 10136, '2024-10-30'),
(59491, 2986551.6900, 20271, '2024-10-31'),
(59504, 2986551.6900, 0, '2024-11-01'),
(59510, 2996687.3600, 10136, '2024-11-02'),
(59518, 3016958.7000, 20271, '2024-11-03'),
(59528, 3027094.3600, 10136, '2024-11-04'),
(59537, 3037230.0300, 10136, '2024-11-05'),
(59549, 3047365.7000, 10136, '2024-11-06'),
(59561, 3057501.3600, 10136, '2024-11-07'),
(59572, 3057501.3600, 0, '2024-11-08'),
(59583, 3077772.7000, 20271, '2024-11-09'),
(59593, 3077772.7000, 0, '2024-11-10'),
(59607, 3108179.7000, 30407, '2024-11-12'),
(59617, 3118315.3700, 10136, '2024-11-13'),
(59620, 3138586.7000, 20271, '2024-11-14'),
(59629, 3138586.7000, 0, '2024-11-15'),
(59638, 3148722.3700, 10136, '2024-11-16'),
(59645, 3158858.0300, 10136, '2024-11-17'),
(59656, 3179129.3700, 20271, '2024-11-18'),
(59663, 3179129.3700, 0, '2024-11-19'),
(59676, 3199400.7000, 20271, '2024-11-20'),
(59681, 3209536.3700, 10136, '2024-11-21'),
(59692, 3219672.0400, 10136, '2024-11-22'),
(59703, 3229807.7000, 10136, '2024-11-23'),
(59716, 3229807.7000, 0, '2024-11-24'),
(59727, 3250079.0400, 20271, '2024-11-25'),
(59739, 3260214.7000, 10136, '2024-11-26'),
(59744, 3270350.3700, 10136, '2024-11-27'),
(59757, 3280486.0400, 10136, '2024-11-28'),
(59768, 3280486.0400, 0, '2024-11-29'),
(59778, 3300757.3700, 20271, '2024-11-30'),
(59784, 3310893.0400, 10136, '2024-12-01'),
(59795, 3321028.7100, 10136, '2024-12-02'),
(59804, 3331264.3700, 10236, '2024-12-03'),
(59810, 3341500.0400, 10236, '2024-12-04'),
(59820, 3351735.7100, 10236, '2024-12-05'),
(59834, 3361571.3700, 9836, '2024-12-06'),
(59845, 3371707.0400, 10136, '2024-12-07'),
(59849, 3371707.0400, 0, '2024-12-08'),
(59862, 3391978.3700, 20271, '2024-12-09'),
(59869, 3402114.0400, 10136, '2024-12-10'),
(59876, 3412249.7100, 10136, '2024-12-11'),
(59889, 3422385.3800, 10136, '2024-12-12'),
(59901, 3432521.0400, 10136, '2024-12-13'),
(59914, 3442656.7100, 10136, '2024-12-14'),
(59928, 3452792.3800, 10136, '2024-12-15'),
(59941, 3462928.0400, 10136, '2024-12-16'),
(59954, 3462928.0400, 0, '2024-12-17'),
(59968, 3483306.0400, 20378, '2024-12-18'),
(59973, 3493495.0400, 10189, '2024-12-19');

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `notificaciones`
--

CREATE TABLE `notificaciones` (
  `id_notificacion` int(11) NOT NULL,
  `id_externo` int(11) NOT NULL,
  `tipo` tinyint(1) NOT NULL CHECK (`tipo` in (0,1)),
  `estado` tinyint(1) NOT NULL CHECK (`estado` in (0,1)),
  `estado2` tinyint(1) NOT NULL CHECK (`estado` in (0,1)),
  `fecha` date NOT NULL,
  `modo` tinyint(1) NOT NULL DEFAULT 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Volcado de datos para la tabla `notificaciones`
--

INSERT INTO `notificaciones` (`id_notificacion`, `id_externo`, `tipo`, `estado`, `estado2`, `fecha`, `modo`) VALUES
(3682, 1, 0, 1, 1, '2024-12-02', 0),
(3683, 2, 0, 1, 1, '2024-12-02', 0),
(3684, 3, 0, 1, 1, '2024-12-02', 0),
(3685, 4, 0, 1, 1, '2024-12-02', 0),
(3686, 5, 0, 1, 1, '2024-12-02', 0),
(3687, 7, 0, 1, 1, '2024-12-02', 0),
(3688, 8, 0, 1, 1, '2024-12-02', 0),
(3689, 9, 0, 1, 1, '2024-12-02', 0),
(3690, 10, 0, 1, 1, '2024-12-02', 0),
(3691, 11, 0, 1, 1, '2024-12-02', 0),
(3692, 12, 0, 1, 1, '2024-12-02', 0),
(3693, 13, 0, 1, 1, '2024-12-02', 0),
(3694, 14, 0, 1, 1, '2024-12-02', 0),
(3695, 15, 0, 1, 1, '2024-12-02', 0),
(3696, 46, 0, 1, 1, '2024-12-02', 0),
(3697, 47, 0, 1, 1, '2024-12-02', 0),
(3698, 48, 0, 1, 1, '2024-12-02', 0),
(3699, 49, 0, 1, 1, '2024-12-02', 0),
(3700, 78, 0, 1, 1, '2024-12-02', 0),
(3701, 79, 0, 1, 1, '2024-12-02', 0),
(3702, 114, 0, 1, 1, '2024-12-02', 0),
(3703, 127, 0, 1, 1, '2024-12-02', 0),
(3714, 1, 0, 1, 1, '2024-12-03', 0),
(3715, 2, 0, 1, 1, '2024-12-03', 0),
(3716, 3, 0, 1, 1, '2024-12-03', 0),
(3717, 4, 0, 1, 1, '2024-12-03', 0),
(3718, 5, 0, 1, 1, '2024-12-03', 0),
(3719, 7, 0, 1, 1, '2024-12-03', 0),
(3720, 8, 0, 1, 1, '2024-12-03', 0),
(3721, 9, 0, 1, 1, '2024-12-03', 0),
(3722, 10, 0, 1, 1, '2024-12-03', 0),
(3723, 11, 0, 1, 1, '2024-12-03', 0),
(3724, 12, 0, 1, 1, '2024-12-03', 0),
(3725, 13, 0, 1, 1, '2024-12-03', 0),
(3726, 14, 0, 1, 1, '2024-12-03', 0),
(3727, 15, 0, 1, 1, '2024-12-03', 0),
(3728, 46, 0, 1, 1, '2024-12-03', 0),
(3729, 47, 0, 1, 1, '2024-12-03', 0),
(3730, 48, 0, 1, 1, '2024-12-03', 0),
(3731, 49, 0, 1, 1, '2024-12-03', 0),
(3732, 78, 0, 1, 1, '2024-12-03', 0),
(3733, 79, 0, 1, 1, '2024-12-03', 0),
(3734, 114, 0, 1, 1, '2024-12-03', 0),
(3735, 127, 0, 1, 1, '2024-12-03', 0),
(3750, 1, 0, 1, 1, '2024-12-04', 0),
(3751, 2, 0, 1, 1, '2024-12-04', 0),
(3752, 3, 0, 1, 1, '2024-12-04', 0),
(3753, 4, 0, 1, 1, '2024-12-04', 0),
(3754, 5, 0, 1, 1, '2024-12-04', 0),
(3755, 7, 0, 1, 1, '2024-12-04', 0),
(3756, 8, 0, 1, 1, '2024-12-04', 0),
(3757, 9, 0, 1, 1, '2024-12-04', 0),
(3758, 10, 0, 1, 1, '2024-12-04', 0),
(3759, 11, 0, 1, 1, '2024-12-04', 0),
(3760, 12, 0, 1, 1, '2024-12-04', 0),
(3761, 13, 0, 1, 1, '2024-12-04', 0),
(3762, 14, 0, 1, 1, '2024-12-04', 0),
(3763, 15, 0, 1, 1, '2024-12-04', 0),
(3764, 46, 0, 1, 1, '2024-12-04', 0),
(3765, 47, 0, 1, 1, '2024-12-04', 0),
(3766, 48, 0, 1, 1, '2024-12-04', 0),
(3767, 49, 0, 1, 1, '2024-12-04', 0),
(3768, 78, 0, 1, 1, '2024-12-04', 0),
(3769, 79, 0, 1, 1, '2024-12-04', 0),
(3770, 114, 0, 1, 1, '2024-12-04', 0),
(3771, 127, 0, 1, 1, '2024-12-04', 0),
(3790, 1, 0, 1, 1, '2024-12-05', 0),
(3791, 2, 0, 1, 1, '2024-12-05', 0),
(3792, 3, 0, 1, 1, '2024-12-05', 0),
(3793, 4, 0, 1, 1, '2024-12-05', 0),
(3794, 5, 0, 1, 1, '2024-12-05', 0),
(3795, 7, 0, 1, 1, '2024-12-05', 0),
(3796, 8, 0, 1, 1, '2024-12-05', 0),
(3797, 9, 0, 1, 1, '2024-12-05', 0),
(3798, 10, 0, 1, 1, '2024-12-05', 0),
(3799, 11, 0, 1, 1, '2024-12-05', 0),
(3800, 12, 0, 1, 1, '2024-12-05', 0),
(3801, 13, 0, 1, 1, '2024-12-05', 0),
(3802, 14, 0, 1, 1, '2024-12-05', 0),
(3803, 15, 0, 1, 1, '2024-12-05', 0),
(3804, 46, 0, 1, 1, '2024-12-05', 0),
(3805, 47, 0, 1, 1, '2024-12-05', 0),
(3806, 48, 0, 1, 1, '2024-12-05', 0),
(3807, 49, 0, 1, 1, '2024-12-05', 0),
(3808, 78, 0, 1, 1, '2024-12-05', 0),
(3809, 79, 0, 1, 1, '2024-12-05', 0),
(3810, 114, 0, 1, 1, '2024-12-05', 0),
(3811, 127, 0, 1, 1, '2024-12-05', 0),
(3826, 375, 1, 1, 1, '2024-12-05', 0),
(3827, 376, 1, 1, 1, '2024-12-05', 0),
(3835, 1, 0, 1, 1, '2024-12-06', 0),
(3836, 2, 0, 1, 1, '2024-12-06', 0),
(3837, 3, 0, 1, 1, '2024-12-06', 0),
(3838, 4, 0, 1, 1, '2024-12-06', 0),
(3839, 5, 0, 1, 1, '2024-12-06', 0),
(3840, 7, 0, 1, 1, '2024-12-06', 0),
(3841, 8, 0, 1, 1, '2024-12-06', 0),
(3842, 9, 0, 1, 1, '2024-12-06', 0),
(3843, 10, 0, 1, 1, '2024-12-06', 0),
(3844, 11, 0, 1, 1, '2024-12-06', 0),
(3845, 12, 0, 1, 1, '2024-12-06', 0),
(3846, 13, 0, 1, 1, '2024-12-06', 0),
(3847, 14, 0, 1, 1, '2024-12-06', 0),
(3848, 15, 0, 1, 1, '2024-12-06', 0),
(3849, 46, 0, 1, 1, '2024-12-06', 0),
(3850, 47, 0, 1, 1, '2024-12-06', 0),
(3851, 48, 0, 1, 1, '2024-12-06', 0),
(3852, 49, 0, 1, 1, '2024-12-06', 0),
(3853, 78, 0, 1, 1, '2024-12-06', 0),
(3854, 79, 0, 1, 1, '2024-12-06', 0),
(3855, 114, 0, 1, 1, '2024-12-06', 0),
(3875, 1, 0, 1, 1, '2024-12-07', 0),
(3876, 2, 0, 1, 1, '2024-12-07', 0),
(3877, 3, 0, 1, 1, '2024-12-07', 0),
(3878, 4, 0, 1, 1, '2024-12-07', 0),
(3879, 5, 0, 1, 1, '2024-12-07', 0),
(3880, 7, 0, 1, 1, '2024-12-07', 0),
(3881, 8, 0, 1, 1, '2024-12-07', 0),
(3882, 9, 0, 1, 1, '2024-12-07', 0),
(3883, 10, 0, 1, 1, '2024-12-07', 0),
(3884, 11, 0, 1, 1, '2024-12-07', 0),
(3885, 12, 0, 1, 1, '2024-12-07', 0),
(3886, 13, 0, 1, 1, '2024-12-07', 0),
(3887, 14, 0, 1, 1, '2024-12-07', 0),
(3888, 15, 0, 1, 1, '2024-12-07', 0),
(3889, 46, 0, 1, 1, '2024-12-07', 0),
(3890, 47, 0, 1, 1, '2024-12-07', 0),
(3891, 48, 0, 1, 1, '2024-12-07', 0),
(3892, 49, 0, 1, 1, '2024-12-07', 0),
(3893, 78, 0, 1, 1, '2024-12-07', 0),
(3894, 79, 0, 1, 1, '2024-12-07', 0),
(3895, 114, 0, 1, 1, '2024-12-07', 0),
(3910, 1, 0, 1, 1, '2024-12-08', 0),
(3911, 2, 0, 1, 1, '2024-12-08', 0),
(3912, 3, 0, 1, 1, '2024-12-08', 0),
(3913, 4, 0, 1, 1, '2024-12-08', 0),
(3914, 5, 0, 1, 1, '2024-12-08', 0),
(3915, 7, 0, 1, 1, '2024-12-08', 0),
(3916, 8, 0, 1, 1, '2024-12-08', 0),
(3917, 9, 0, 1, 1, '2024-12-08', 0),
(3918, 10, 0, 1, 1, '2024-12-08', 0),
(3919, 11, 0, 1, 1, '2024-12-08', 0),
(3920, 12, 0, 1, 1, '2024-12-08', 0),
(3921, 13, 0, 1, 1, '2024-12-08', 0),
(3922, 14, 0, 1, 1, '2024-12-08', 0),
(3923, 15, 0, 1, 1, '2024-12-08', 0),
(3924, 46, 0, 1, 1, '2024-12-08', 0),
(3925, 47, 0, 1, 1, '2024-12-08', 0),
(3926, 48, 0, 1, 1, '2024-12-08', 0),
(3927, 49, 0, 1, 1, '2024-12-08', 0),
(3928, 78, 0, 1, 1, '2024-12-08', 0),
(3929, 79, 0, 1, 1, '2024-12-08', 0),
(3930, 114, 0, 1, 1, '2024-12-08', 0),
(3953, 1, 0, 1, 1, '2024-12-09', 0),
(3954, 2, 0, 1, 1, '2024-12-09', 0),
(3955, 3, 0, 1, 1, '2024-12-09', 0),
(3956, 4, 0, 1, 1, '2024-12-09', 0),
(3957, 5, 0, 1, 1, '2024-12-09', 0),
(3958, 7, 0, 1, 1, '2024-12-09', 0),
(3959, 8, 0, 1, 1, '2024-12-09', 0),
(3960, 9, 0, 1, 1, '2024-12-09', 0),
(3961, 10, 0, 1, 1, '2024-12-09', 0),
(3962, 11, 0, 1, 1, '2024-12-09', 0),
(3963, 12, 0, 1, 1, '2024-12-09', 0),
(3964, 13, 0, 1, 1, '2024-12-09', 0),
(3965, 14, 0, 1, 1, '2024-12-09', 0),
(3966, 15, 0, 1, 1, '2024-12-09', 0),
(3967, 46, 0, 1, 1, '2024-12-09', 0),
(3968, 47, 0, 1, 1, '2024-12-09', 0),
(3969, 48, 0, 1, 1, '2024-12-09', 0),
(3970, 49, 0, 1, 1, '2024-12-09', 0),
(3971, 78, 0, 1, 1, '2024-12-09', 0),
(3972, 79, 0, 1, 1, '2024-12-09', 0),
(3973, 114, 0, 1, 1, '2024-12-09', 0),
(3990, 1, 0, 1, 1, '2024-12-10', 0),
(3991, 2, 0, 1, 1, '2024-12-10', 0),
(3992, 3, 0, 1, 1, '2024-12-10', 0),
(3993, 4, 0, 1, 1, '2024-12-10', 0),
(3994, 5, 0, 1, 1, '2024-12-10', 0),
(3995, 7, 0, 1, 1, '2024-12-10', 0),
(3996, 8, 0, 1, 1, '2024-12-10', 0),
(3997, 9, 0, 1, 1, '2024-12-10', 0),
(3998, 10, 0, 1, 1, '2024-12-10', 0),
(3999, 11, 0, 1, 1, '2024-12-10', 0),
(4000, 12, 0, 1, 1, '2024-12-10', 0),
(4001, 13, 0, 1, 1, '2024-12-10', 0),
(4002, 14, 0, 1, 1, '2024-12-10', 0),
(4003, 15, 0, 1, 1, '2024-12-10', 0),
(4004, 46, 0, 1, 1, '2024-12-10', 0),
(4005, 47, 0, 1, 1, '2024-12-10', 0),
(4006, 48, 0, 1, 1, '2024-12-10', 0),
(4007, 49, 0, 1, 1, '2024-12-10', 0),
(4008, 78, 0, 1, 1, '2024-12-10', 0),
(4009, 79, 0, 1, 1, '2024-12-10', 0),
(4010, 114, 0, 1, 1, '2024-12-10', 0),
(4022, 377, 1, 1, 1, '2024-12-10', 0),
(4023, 378, 1, 1, 1, '2024-12-10', 0),
(4024, 379, 1, 1, 1, '2024-12-10', 0),
(4025, 380, 1, 1, 1, '2024-12-10', 0),
(4026, 381, 1, 1, 1, '2024-12-10', 0),
(4032, 1, 0, 1, 1, '2024-12-11', 0),
(4033, 2, 0, 1, 1, '2024-12-11', 0),
(4034, 3, 0, 1, 1, '2024-12-11', 0),
(4035, 4, 0, 1, 1, '2024-12-11', 0),
(4036, 5, 0, 1, 1, '2024-12-11', 0),
(4037, 7, 0, 1, 1, '2024-12-11', 0),
(4038, 8, 0, 1, 1, '2024-12-11', 0),
(4039, 9, 0, 1, 1, '2024-12-11', 0),
(4040, 10, 0, 1, 1, '2024-12-11', 0),
(4041, 11, 0, 1, 1, '2024-12-11', 0),
(4042, 12, 0, 1, 1, '2024-12-11', 0),
(4043, 13, 0, 1, 1, '2024-12-11', 0),
(4044, 14, 0, 1, 1, '2024-12-11', 0),
(4045, 15, 0, 1, 1, '2024-12-11', 0),
(4046, 46, 0, 1, 1, '2024-12-11', 0),
(4047, 47, 0, 1, 1, '2024-12-11', 0),
(4048, 48, 0, 1, 1, '2024-12-11', 0),
(4049, 49, 0, 1, 1, '2024-12-11', 0),
(4050, 78, 0, 1, 1, '2024-12-11', 0),
(4051, 79, 0, 1, 1, '2024-12-11', 0),
(4052, 114, 0, 1, 1, '2024-12-11', 0),
(4074, 382, 1, 1, 1, '2024-12-11', 0),
(4076, 1, 0, 1, 1, '2024-12-12', 0),
(4077, 2, 0, 1, 1, '2024-12-12', 0),
(4078, 3, 0, 1, 1, '2024-12-12', 0),
(4079, 4, 0, 1, 1, '2024-12-12', 0),
(4080, 5, 0, 1, 1, '2024-12-12', 0),
(4081, 7, 0, 1, 1, '2024-12-12', 0),
(4082, 8, 0, 1, 1, '2024-12-12', 0),
(4083, 9, 0, 1, 1, '2024-12-12', 0),
(4084, 10, 0, 1, 1, '2024-12-12', 0),
(4085, 11, 0, 1, 1, '2024-12-12', 0),
(4086, 12, 0, 1, 1, '2024-12-12', 0),
(4087, 13, 0, 1, 1, '2024-12-12', 0),
(4088, 14, 0, 1, 1, '2024-12-12', 0),
(4089, 15, 0, 1, 1, '2024-12-12', 0),
(4090, 46, 0, 1, 1, '2024-12-12', 0),
(4091, 47, 0, 1, 1, '2024-12-12', 0),
(4092, 48, 0, 1, 1, '2024-12-12', 0),
(4093, 49, 0, 1, 1, '2024-12-12', 0),
(4094, 78, 0, 1, 1, '2024-12-12', 0),
(4095, 79, 0, 1, 1, '2024-12-12', 0),
(4096, 114, 0, 1, 1, '2024-12-12', 0),
(4118, 1, 0, 1, 1, '2024-12-13', 0),
(4119, 2, 0, 1, 1, '2024-12-13', 0),
(4120, 3, 0, 1, 1, '2024-12-13', 0),
(4121, 4, 0, 1, 1, '2024-12-13', 0),
(4122, 5, 0, 1, 1, '2024-12-13', 0),
(4123, 7, 0, 1, 1, '2024-12-13', 0),
(4124, 8, 0, 1, 1, '2024-12-13', 0),
(4125, 9, 0, 1, 1, '2024-12-13', 0),
(4126, 10, 0, 1, 1, '2024-12-13', 0),
(4127, 11, 0, 1, 1, '2024-12-13', 0),
(4128, 12, 0, 1, 1, '2024-12-13', 0),
(4129, 13, 0, 1, 1, '2024-12-13', 0),
(4130, 14, 0, 1, 1, '2024-12-13', 0),
(4131, 15, 0, 1, 1, '2024-12-13', 0),
(4132, 46, 0, 1, 1, '2024-12-13', 0),
(4133, 47, 0, 1, 1, '2024-12-13', 0),
(4134, 48, 0, 1, 1, '2024-12-13', 0),
(4135, 49, 0, 1, 1, '2024-12-13', 0),
(4136, 78, 0, 1, 1, '2024-12-13', 0),
(4137, 79, 0, 1, 1, '2024-12-13', 0),
(4138, 114, 0, 1, 1, '2024-12-13', 0),
(4161, 1, 0, 1, 1, '2024-12-14', 0),
(4162, 2, 0, 1, 1, '2024-12-14', 0),
(4163, 3, 0, 1, 1, '2024-12-14', 0),
(4164, 4, 0, 1, 1, '2024-12-14', 0),
(4165, 5, 0, 1, 1, '2024-12-14', 0),
(4166, 7, 0, 1, 1, '2024-12-14', 0),
(4167, 8, 0, 1, 1, '2024-12-14', 0),
(4168, 9, 0, 1, 1, '2024-12-14', 0),
(4169, 10, 0, 1, 1, '2024-12-14', 0),
(4170, 11, 0, 1, 1, '2024-12-14', 0),
(4171, 12, 0, 1, 1, '2024-12-14', 0),
(4172, 13, 0, 1, 1, '2024-12-14', 0),
(4173, 14, 0, 1, 1, '2024-12-14', 0),
(4174, 15, 0, 1, 1, '2024-12-14', 0),
(4175, 46, 0, 1, 1, '2024-12-14', 0),
(4176, 47, 0, 1, 1, '2024-12-14', 0),
(4177, 48, 0, 1, 1, '2024-12-14', 0),
(4178, 49, 0, 1, 1, '2024-12-14', 0),
(4179, 78, 0, 1, 1, '2024-12-14', 0),
(4180, 79, 0, 1, 1, '2024-12-14', 0),
(4181, 114, 0, 1, 1, '2024-12-14', 0),
(4205, 1, 0, 1, 1, '2024-12-15', 0),
(4206, 2, 0, 1, 1, '2024-12-15', 0),
(4207, 3, 0, 1, 1, '2024-12-15', 0),
(4208, 4, 0, 1, 1, '2024-12-15', 0),
(4209, 5, 0, 1, 1, '2024-12-15', 0),
(4210, 7, 0, 1, 1, '2024-12-15', 0),
(4211, 8, 0, 1, 1, '2024-12-15', 0),
(4212, 9, 0, 1, 1, '2024-12-15', 0),
(4213, 10, 0, 1, 1, '2024-12-15', 0),
(4214, 11, 0, 1, 1, '2024-12-15', 0),
(4215, 12, 0, 1, 1, '2024-12-15', 0),
(4216, 13, 0, 1, 1, '2024-12-15', 0),
(4217, 14, 0, 1, 1, '2024-12-15', 0),
(4218, 15, 0, 1, 1, '2024-12-15', 0),
(4219, 46, 0, 1, 1, '2024-12-15', 0),
(4220, 47, 0, 1, 1, '2024-12-15', 0),
(4221, 48, 0, 1, 1, '2024-12-15', 0),
(4222, 49, 0, 1, 1, '2024-12-15', 0),
(4223, 78, 0, 1, 1, '2024-12-15', 0),
(4224, 79, 0, 1, 1, '2024-12-15', 0),
(4225, 114, 0, 1, 1, '2024-12-15', 0),
(4249, 1, 0, 1, 1, '2024-12-16', 0),
(4250, 2, 0, 1, 1, '2024-12-16', 0),
(4251, 3, 0, 1, 1, '2024-12-16', 0),
(4252, 4, 0, 1, 1, '2024-12-16', 0),
(4253, 5, 0, 1, 1, '2024-12-16', 0),
(4254, 7, 0, 1, 1, '2024-12-16', 0),
(4255, 8, 0, 1, 1, '2024-12-16', 0),
(4256, 9, 0, 1, 1, '2024-12-16', 0),
(4257, 10, 0, 1, 1, '2024-12-16', 0),
(4258, 11, 0, 1, 1, '2024-12-16', 0),
(4259, 12, 0, 1, 1, '2024-12-16', 0),
(4260, 13, 0, 1, 1, '2024-12-16', 0),
(4261, 14, 0, 1, 1, '2024-12-16', 0),
(4262, 15, 0, 1, 1, '2024-12-16', 0),
(4263, 46, 0, 1, 1, '2024-12-16', 0),
(4264, 47, 0, 1, 1, '2024-12-16', 0),
(4265, 48, 0, 1, 1, '2024-12-16', 0),
(4266, 49, 0, 1, 1, '2024-12-16', 0),
(4267, 78, 0, 1, 1, '2024-12-16', 0),
(4268, 79, 0, 1, 1, '2024-12-16', 0),
(4269, 114, 0, 1, 1, '2024-12-16', 0),
(4289, 383, 1, 1, 1, '2024-12-16', 0),
(4292, 1, 0, 1, 1, '2024-12-17', 0),
(4293, 2, 0, 1, 1, '2024-12-17', 0),
(4294, 3, 0, 1, 1, '2024-12-17', 0),
(4295, 4, 0, 1, 1, '2024-12-17', 0),
(4296, 5, 0, 1, 1, '2024-12-17', 0),
(4297, 7, 0, 1, 1, '2024-12-17', 0),
(4298, 8, 0, 1, 1, '2024-12-17', 0),
(4299, 9, 0, 1, 1, '2024-12-17', 0),
(4300, 10, 0, 1, 1, '2024-12-17', 0),
(4301, 11, 0, 1, 1, '2024-12-17', 0),
(4302, 12, 0, 1, 1, '2024-12-17', 0),
(4303, 13, 0, 1, 1, '2024-12-17', 0),
(4304, 14, 0, 1, 1, '2024-12-17', 0),
(4305, 15, 0, 1, 1, '2024-12-17', 0),
(4306, 46, 0, 1, 1, '2024-12-17', 0),
(4307, 47, 0, 1, 1, '2024-12-17', 0),
(4308, 48, 0, 1, 1, '2024-12-17', 0),
(4309, 49, 0, 1, 1, '2024-12-17', 0),
(4310, 78, 0, 1, 1, '2024-12-17', 0),
(4311, 79, 0, 1, 1, '2024-12-17', 0),
(4312, 114, 0, 1, 1, '2024-12-17', 0),
(4313, 130, 0, 1, 1, '2024-12-17', 0),
(4335, 384, 1, 1, 1, '2024-12-17', 0),
(4338, 1, 0, 1, 1, '2024-12-18', 0),
(4339, 2, 0, 1, 1, '2024-12-18', 0),
(4340, 3, 0, 1, 1, '2024-12-18', 0),
(4341, 4, 0, 1, 1, '2024-12-18', 0),
(4342, 5, 0, 1, 1, '2024-12-18', 0),
(4343, 7, 0, 1, 1, '2024-12-18', 0),
(4344, 8, 0, 1, 1, '2024-12-18', 0),
(4345, 9, 0, 1, 1, '2024-12-18', 0),
(4346, 10, 0, 1, 1, '2024-12-18', 0),
(4347, 11, 0, 1, 1, '2024-12-18', 0),
(4348, 12, 0, 1, 1, '2024-12-18', 0),
(4349, 13, 0, 1, 1, '2024-12-18', 0),
(4350, 14, 0, 1, 1, '2024-12-18', 0),
(4351, 15, 0, 1, 1, '2024-12-18', 0),
(4352, 46, 0, 1, 1, '2024-12-18', 0),
(4353, 47, 0, 1, 1, '2024-12-18', 0),
(4354, 48, 0, 1, 1, '2024-12-18', 0),
(4355, 49, 0, 1, 1, '2024-12-18', 0),
(4356, 78, 0, 1, 1, '2024-12-18', 0),
(4357, 79, 0, 1, 1, '2024-12-18', 0),
(4358, 114, 0, 1, 1, '2024-12-18', 0),
(4359, 130, 0, 1, 1, '2024-12-18', 0),
(4369, 385, 1, 1, 1, '2024-12-18', 0),
(4373, 1, 0, 1, 1, '2024-12-19', 0),
(4374, 2, 0, 1, 1, '2024-12-19', 0),
(4375, 3, 0, 1, 1, '2024-12-19', 0),
(4376, 4, 0, 1, 1, '2024-12-19', 0),
(4377, 5, 0, 1, 1, '2024-12-19', 0),
(4378, 7, 0, 1, 1, '2024-12-19', 0),
(4379, 8, 0, 1, 1, '2024-12-19', 0),
(4380, 9, 0, 1, 1, '2024-12-19', 0),
(4381, 10, 0, 1, 1, '2024-12-19', 0),
(4382, 11, 0, 1, 1, '2024-12-19', 0),
(4383, 12, 0, 1, 1, '2024-12-19', 0),
(4384, 13, 0, 1, 1, '2024-12-19', 0),
(4385, 14, 0, 1, 1, '2024-12-19', 0),
(4386, 15, 0, 1, 1, '2024-12-19', 0),
(4387, 46, 0, 1, 1, '2024-12-19', 0),
(4388, 47, 0, 1, 1, '2024-12-19', 0),
(4389, 48, 0, 1, 1, '2024-12-19', 0),
(4390, 49, 0, 1, 1, '2024-12-19', 0),
(4391, 78, 0, 1, 1, '2024-12-19', 0),
(4392, 79, 0, 1, 1, '2024-12-19', 0),
(4393, 114, 0, 1, 1, '2024-12-19', 0),
(4394, 130, 0, 1, 1, '2024-12-19', 0);

--
-- Disparadores `notificaciones`
--
DELIMITER $$
CREATE TRIGGER `validar_deudas` BEFORE INSERT ON `notificaciones` FOR EACH ROW BEGIN
    IF NEW.tipo = 0 THEN
        IF NOT EXISTS (SELECT 1 FROM deudas WHERE deudas.id_deuda = NEW.id_externo) THEN
            SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'id_externo no válido para prestamos';
        END IF;
    END IF;
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `validar_pagos` BEFORE INSERT ON `notificaciones` FOR EACH ROW BEGIN
    IF NEW.tipo = 1 THEN
        IF NOT EXISTS (SELECT 1 FROM pagos WHERE pagos.id_pago = NEW.id_externo) THEN
            SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'id_externo no válido para pagos';
        END IF;
    END IF;
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `pagos`
--

CREATE TABLE `pagos` (
  `id_pago` int(11) NOT NULL,
  `valor_pago` float NOT NULL,
  `id_deuda` int(11) NOT NULL,
  `fecha_pago` date DEFAULT NULL,
  `estado` int(11) DEFAULT NULL,
  `comprovante_pago` varchar(40) DEFAULT NULL,
  `id_update` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Volcado de datos para la tabla `pagos`
--

INSERT INTO `pagos` (`id_pago`, `valor_pago`, `id_deuda`, `fecha_pago`, `estado`, `comprovante_pago`, `id_update`) VALUES
(1, 10000, 1, NULL, 0, NULL, NULL),
(2, 10000, 1, NULL, 0, NULL, NULL),
(3, 10000, 1, NULL, 0, NULL, NULL),
(4, 10000, 1, NULL, 0, NULL, NULL),
(5, 10000, 1, NULL, 0, NULL, NULL),
(6, 15000, 1, NULL, 0, NULL, NULL),
(7, 15000, 1, NULL, 0, NULL, NULL),
(8, 15000, 1, NULL, 0, NULL, NULL),
(9, 15000, 1, NULL, 0, NULL, NULL),
(10, 15000, 1, NULL, 0, NULL, NULL),
(11, 15000, 1, NULL, 0, NULL, NULL),
(12, 15000, 1, NULL, 0, NULL, NULL),
(13, 15000, 1, NULL, 0, NULL, NULL),
(14, 15000, 1, NULL, 0, NULL, NULL),
(15, 2200, 1, NULL, 0, NULL, NULL),
(16, 5000, 1, NULL, 0, NULL, NULL),
(17, 10000, 1, NULL, 0, NULL, NULL),
(18, 4000, 1, NULL, 0, NULL, NULL),
(19, 2500, 1, NULL, 0, NULL, NULL),
(20, 4000, 1, NULL, 0, NULL, NULL),
(21, 3000, 1, NULL, 0, NULL, NULL),
(22, 6000, 1, NULL, 0, NULL, NULL),
(23, 2000, 1, NULL, 0, NULL, NULL),
(24, 1300, 1, NULL, 0, NULL, NULL),
(25, 200000, 1, NULL, 0, NULL, NULL),
(26, 10500, 1, NULL, 0, NULL, NULL),
(27, 10500, 1, NULL, 0, NULL, NULL),
(28, 10500, 1, NULL, 0, NULL, NULL),
(29, 10500, 1, NULL, 0, NULL, NULL),
(30, 10500, 1, NULL, 0, NULL, NULL),
(31, 10500, 1, NULL, 0, NULL, NULL),
(32, 10500, 1, NULL, 0, NULL, NULL),
(33, 10500, 1, NULL, 0, NULL, NULL),
(34, 10500, 1, NULL, 0, NULL, NULL),
(35, 10500, 1, NULL, 0, NULL, NULL),
(36, 10500, 1, NULL, 0, NULL, NULL),
(37, 10500, 1, NULL, 0, NULL, NULL),
(38, 10500, 1, NULL, 0, NULL, NULL),
(39, 2350, 2, NULL, 0, NULL, NULL),
(40, 2350, 2, NULL, 0, NULL, NULL),
(41, 2350, 2, NULL, 0, NULL, NULL),
(42, 2350, 2, NULL, 0, NULL, NULL),
(43, 2350, 2, NULL, 0, NULL, NULL),
(45, 3525, 2, NULL, 0, NULL, NULL),
(46, 3525, 2, NULL, 0, NULL, NULL),
(47, 3525, 2, NULL, 0, NULL, NULL),
(48, 1175, 2, NULL, 0, NULL, NULL),
(49, 5000, 3, NULL, 0, NULL, NULL),
(50, 5000, 3, NULL, 0, NULL, NULL),
(51, 5000, 3, NULL, 0, NULL, NULL),
(52, 5000, 3, NULL, 0, NULL, NULL),
(53, 5000, 3, NULL, 0, NULL, NULL),
(54, 5000, 3, NULL, 0, NULL, NULL),
(55, 5000, 3, NULL, 0, NULL, NULL),
(56, 5000, 3, NULL, 0, NULL, NULL),
(57, 5000, 3, NULL, 0, NULL, NULL),
(58, 5000, 3, NULL, 0, NULL, NULL),
(59, 5000, 3, NULL, 0, NULL, NULL),
(60, 5000, 3, NULL, 0, NULL, NULL),
(61, 10000, 7, NULL, 0, NULL, NULL),
(62, 5000, 7, NULL, 0, NULL, NULL),
(63, 5000, 16, NULL, 0, NULL, NULL),
(64, 5000, 16, NULL, 0, NULL, NULL),
(65, 5000, 16, NULL, 0, NULL, NULL),
(66, 5000, 16, NULL, 0, NULL, NULL),
(67, 4000, 16, NULL, 0, NULL, NULL),
(68, 5000, 16, NULL, 0, NULL, NULL),
(69, 4000, 16, NULL, 0, NULL, NULL),
(70, 5000, 16, NULL, 0, NULL, NULL),
(71, 5000, 16, NULL, 0, NULL, NULL),
(72, 5000, 16, NULL, 0, NULL, NULL),
(73, 5000, 16, NULL, 0, NULL, NULL),
(74, 5000, 16, NULL, 0, NULL, NULL),
(75, 5000, 16, NULL, 0, NULL, NULL),
(76, 5000, 16, NULL, 0, NULL, NULL),
(77, 5000, 16, NULL, 0, NULL, NULL),
(78, 5000, 16, NULL, 0, NULL, NULL),
(79, 5000, 16, NULL, 0, NULL, NULL),
(80, 20000, 16, NULL, 0, NULL, NULL),
(81, 5000, 16, NULL, 0, NULL, NULL),
(82, 10000, 16, NULL, 0, NULL, NULL),
(83, 20000, 16, NULL, 0, NULL, NULL),
(84, 10000, 16, NULL, 0, NULL, NULL),
(85, 5000, 16, NULL, 0, NULL, NULL),
(86, 5000, 16, NULL, 0, NULL, NULL),
(87, 16000, 16, NULL, 0, NULL, NULL),
(88, 10000, 16, NULL, 0, NULL, NULL),
(89, 20000, 16, NULL, 0, NULL, NULL),
(90, 10000, 16, NULL, 0, NULL, NULL),
(91, 14000, 16, NULL, 0, NULL, NULL),
(92, 32000, 19, '2024-02-05', 0, NULL, NULL),
(93, 32000, 19, '2024-03-05', 0, NULL, NULL),
(94, 32000, 19, '2024-04-05', 0, NULL, NULL),
(95, 32000, 19, '2024-05-05', 0, NULL, NULL),
(96, 32000, 19, '2024-06-05', 0, NULL, NULL),
(97, 200000, 22, '2024-01-23', 0, NULL, NULL),
(98, 55000, 17, '0000-00-00', 0, NULL, NULL),
(99, 70000, 18, '0000-00-00', 0, NULL, NULL),
(121, 150, 1, '2024-06-22', 0, NULL, NULL),
(122, 30000, 20, '2024-06-25', 0, NULL, NULL),
(131, 11000, 33, '2024-06-29', 0, NULL, NULL),
(166, 30000, 31, '2024-06-30', 0, NULL, NULL),
(169, 5000, 19, '2024-07-01', 0, NULL, NULL),
(170, 3000, 20, '2024-07-01', 0, NULL, NULL),
(171, 14000, 21, '2024-07-01', 0, NULL, NULL),
(172, 1000, 21, '2024-07-01', 0, NULL, NULL),
(180, 50000, 21, '2024-07-02', 0, NULL, NULL),
(249, 12000, 21, '2024-07-14', 0, 'Pago66948e76bf951', NULL),
(250, 10000, 54, '2024-07-14', 0, 'Pago66948ebe23cbc', NULL),
(251, 1000, 54, '2024-07-14', 0, 'Pago66948f0c1d4db', NULL),
(255, 50, 76, '2024-07-15', 0, 'Pago6695a1f2af46c', NULL),
(296, 5200, 80, '2024-07-26', 2, 'Pago66a42f6feea87', NULL),
(297, 5200, 80, '2024-07-26', 0, 'Pago66a42fbc417db', NULL),
(298, 10000, 4, '2024-07-27', 0, 'Pago66a5217a49a8c', NULL),
(299, 5500, 103, '2024-07-27', 0, 'Pago66a5259a4d23d', NULL),
(300, 22000, 104, '2024-07-27', 0, 'Pago66a525fc26f6c', NULL),
(301, 50, 106, '2024-07-27', 2, 'Pago66a529b88c499', NULL),
(302, 50, 106, '2024-07-27', 2, 'Pago66a57825ae852', NULL),
(303, 50, 106, '2024-07-27', 2, 'Pago66a57986223b7', NULL),
(304, 50, 106, '2024-07-27', 2, 'Pago66a5798d351ba', NULL),
(305, 50, 106, '2024-07-27', 2, 'Pago66a57a8a8ad09', NULL),
(306, 50, 106, '2024-07-27', 2, 'Pago66a57a96744c0', NULL),
(307, 8000, 80, '2024-07-31', 0, 'Pago66aac1a94a589', NULL),
(308, 4000, 108, '2024-07-31', 0, 'Pago66aac22518cef', NULL),
(309, 500, 108, '2024-07-31', 2, 'Pago66aac3fd1e393', NULL),
(310, 500, 108, '2024-07-31', 0, 'Pago66aac43604784', NULL),
(311, 500, 107, '2024-07-31', 2, 'Pago66aac6202d226', 1),
(312, 500, 108, '2024-07-31', 2, 'Pago66aacbe27d9a9', 1),
(313, 500, 108, '2024-07-31', 2, 'Pago66aacc605f88c', 1),
(314, 7000, 108, '2024-08-01', 2, 'Pago66ac3643adc9f', 1),
(315, 3000, 107, '2024-08-01', 2, 'Pago66ac366835f72', 1),
(316, 50, 106, '2024-08-01', 2, 'Pago66ac43636c135', 1),
(317, 2000, 107, '2024-08-02', 2, 'Pago66adab0b6a302', 1),
(318, 2000, 107, '2024-08-02', 0, 'Pago66adab95cdcd1', 1),
(319, 10000, 107, '2024-08-04', 0, 'Pago66b044adaecc3', 1),
(320, 1000, 107, '2024-08-04', 0, 'Pago66b044fbbc9f6', 1),
(321, 17000, 107, '2024-08-05', 0, 'Pago66b14442c20ab', 1),
(322, 10000, 77, '2024-08-15', 0, 'Pago66bde6db29a3e', NULL),
(331, 10000, 77, '2024-08-16', 0, 'Pago66c00cca11968', NULL),
(332, 10000, 77, '2024-08-19', 0, 'Pago66c40406e6d8b', NULL),
(333, 21000, 115, '2024-08-19', 0, 'Pago66c4042a2095f', NULL),
(334, 10000, 77, '2024-08-20', 0, 'Pago66c54ec7772d5', NULL),
(335, 1000, 115, '2024-08-21', 0, 'Pago66c63790b93b6', NULL),
(336, 39000, 77, '2024-08-21', 0, 'Pago66c637ae3b2b2', NULL),
(337, 16500, 105, '2024-08-27', 0, 'Pago66ce6cfa38c03', 1),
(338, 23500, 4, '2024-08-27', 0, 'Pago66ce6d67eb7d3', 1),
(339, 10000, 77, '2024-08-27', 0, 'Pago66ce928f65394', NULL),
(340, 50, 114, '2024-08-27', 0, 'Pago66ce948825833', NULL),
(341, 50, 114, '2024-08-27', 0, 'Pago66ce94aee241c', NULL),
(342, 10000, 77, '2024-08-28', 0, 'Pago66cff4e76a94d', NULL),
(343, 50, 114, '2024-08-29', 0, 'Pago66d0d6b911391', NULL),
(344, 50, 114, '2024-08-29', 0, 'Pago66d0d85c8eafb', NULL),
(345, 50, 114, '2024-08-29', 0, 'Pago66d0d8ce4a2bb', NULL),
(346, 50, 114, '2024-08-29', 0, 'Pago66d0d94a4ace6', NULL),
(347, 50, 114, '2024-08-29', 0, 'Pago66d0db62d8f3f', NULL),
(348, 10000, 77, '2024-08-29', 0, 'Pago66d13b1e521f6', NULL),
(349, 10000, 77, '2024-09-03', 0, 'Pago66d75e184dec0', NULL),
(350, 10000, 77, '2024-09-04', 0, 'Pago66d9065915f38', NULL),
(351, 10000, 77, '2024-09-05', 0, 'Pago66da5ee6535d6', NULL),
(352, 10000, 77, '2024-09-08', 0, 'Pago66dde415ceb44', NULL),
(353, 5000, 116, '2024-09-10', 0, 'Pago66e0cc88f0aa7', NULL),
(354, 10000, 117, '2024-09-13', 0, 'Pago66e4cdeea307c', NULL),
(355, 14200, 117, '2024-09-14', 0, 'Pago66e62c6d4535e', NULL),
(356, 11000, 118, '2024-09-17', 0, 'Pago66ea183897b85', NULL),
(357, 52300, 116, '2024-09-17', 0, 'Pago66ea18634d76a', NULL),
(358, 50000, 116, '2024-09-22', 0, 'Pago66f0db58093ce', NULL),
(359, 52000, 122, '2024-09-26', 0, 'Pago66f61126c13db', NULL),
(360, 50000, 116, '2024-09-29', 0, 'Pago66fa1aef3b29e', NULL),
(361, 100000, 120, '2024-10-02', 0, 'Pago66fdbcc952261', NULL),
(362, 100000, 77, '2024-10-03', 0, 'Pago66ff4ff908cbc', NULL),
(363, 32000, 122, '2024-10-11', 0, 'Pago67097e36adce7', NULL),
(364, 50000, 120, '2024-10-11', 0, 'Pago6709c1994e2c7', NULL),
(365, 35900, 122, '2024-10-14', 0, 'Pago670ddb68cf20c', NULL),
(366, 14100, 116, '2024-10-14', 0, 'Pago670ddb9fa5e87', NULL),
(367, 5400, 116, '2024-10-14', 0, 'Pago670ddd0be844c', NULL),
(368, 50000, 123, '2024-10-27', 0, 'Pago671f003a709e1', NULL),
(369, 27000, 123, '2024-11-03', 0, 'Pago672781d14e25a', NULL),
(370, 32000, 124, '2024-11-12', 0, 'Pago67340000c379f', NULL),
(371, 5000, 124, '2024-11-18', 0, 'Pago673bc2e61efd8', NULL),
(372, 17000, 124, '2024-11-23', 0, 'Pago674235b93d88d', NULL),
(373, 12000, 124, '2024-11-24', 0, 'Pago6743b25877f26', NULL),
(374, 1100, 126, '2024-11-24', 0, 'Pago6743b2838cfa5', NULL),
(375, 22000, 128, '2024-12-05', 0, 'Pago67520be369c2b', NULL),
(376, 30300, 127, '2024-12-05', 0, 'Pago67520bf6420af', NULL),
(377, 10000, 40, '2024-12-10', 0, 'Pago6758d2c378beb', NULL),
(378, 1000, 40, '2024-12-10', 0, 'Pago6758d31a8d8ee', NULL),
(379, 3000, 44, '2024-12-10', 0, 'Pago6758d333501c3', NULL),
(380, 7000, 45, '2024-12-10', 0, 'Pago6758d34dce910', NULL),
(381, 10000, 45, '2024-12-10', 0, 'Pago6758d430db62c', NULL),
(382, 10000, 45, '2024-12-11', 0, 'Pago675a5412067e5', NULL),
(383, 10000, 120, '2024-12-16', 0, 'Pago6760dbf582766', NULL),
(384, 10000, 129, '2024-12-17', 0, 'Pago676246751a1ca', NULL),
(385, 10000, 45, '2024-12-18', 0, 'Pago676364ba3a2ca', NULL);

--
-- Disparadores `pagos`
--
DELIMITER $$
CREATE TRIGGER `after_insert_pago` AFTER INSERT ON `pagos` FOR EACH ROW BEGIN
    INSERT INTO notificaciones (id_externo, tipo, estado, estado2 , fecha , modo)
    VALUES (NEW.id_pago, 1, 1, 1 , CURDATE() , 0);
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `after_update_pagos` AFTER UPDATE ON `pagos` FOR EACH ROW BEGIN
    INSERT INTO notificaciones (id_externo, tipo, estado, estado2 , fecha , modo)
    VALUES (NEW.id_pago, 1, 1 , 1 , NOW() , 1);
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `usuario`
--

CREATE TABLE `usuario` (
  `nombre_usuario` varchar(30) NOT NULL,
  `id_usuario` int(11) NOT NULL,
  `credencial_usuario` varchar(30) NOT NULL,
  `contrasena` varchar(90) NOT NULL,
  `tipo` int(11) NOT NULL,
  `palabra_segura` varchar(90) DEFAULT NULL,
  `estado` int(11) NOT NULL DEFAULT 0,
  `cedula` int(11) DEFAULT NULL,
  `correo` varchar(50) DEFAULT NULL,
  `foto_perfil` varchar(40) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Volcado de datos para la tabla `usuario`
--

INSERT INTO `usuario` (`nombre_usuario`, `id_usuario`, `credencial_usuario`, `contrasena`, `tipo`, `palabra_segura`, `estado`, `cedula`, `correo`, `foto_perfil`) VALUES
('Heider', 1, 'adm2024', '$2y$10$r3tO5kfG2d29bf6NyPJkK.4FRBC6iaHd4Y3lWk/CuPv/Xkkjj0Eym', 1, '$2y$10$XXmgwjCAUhcOS8Oo5SnqHOdZh3ESul6qbMlh01yZFsbkVfQE2HLQm', 1, 1104695776, 'heiderleyton22@gmail.com', 'fotoPerfil16692ae9b50598'),
('Coco', 2, 'coco', '$2y$10$mZt54TDvssNd.VfMKZzonO5MhzHD6A7wIkQj.ajgeWJKQ1a1wMlXe', 0, '$2y$10$t.3HWN1H8c4zV3vQpv8.DutP8CquZIOW4wsBebQqMKZjCgNjZkrfq', 1, 1104695777, '123@123.com', 'fotoPerfil7'),
('Heider', 3, 'Heider', '$2y$10$mZt54TDvssNd.VfMKZzonO5MhzHD6A7wIkQj.ajgeWJKQ1a1wMlXe', 0, '$2y$10$ttj05SrX1xvc7ok2a8ZIoOmtVlHjOvvBkUF.ZnpW39vtx8D2nIFWu', 0, 123456789, 'heiderleyton33@gmail.com', 'fotoPerfil669b34b4aa7a5'),
('Anlly', 5, 'Anlly', '$2y$10$SWDtU7hnhGs//mi7Ja.nuejA9uLWQrywENWrRsRZCWD0ZcUipLSZW', 0, '$2y$10$utii2Bv9SfQSPM/DQvaeLO3hXorYnVVmfMlIX5G.05HJlIITNkKEy', 0, 1024517826, 'anllyleyton58@gmail.com', 'fotoPerfil7'),
('Edwin Leyton ', 6, 'Edwin Leyton ', '$2y$10$t.3HWN1H8c4zV3vQpv8.DutP8CquZIOW4wsBebQqMKZjCgNjZkrfq', 0, '$2y$10$t.3HWN1H8c4zV3vQpv8.DutP8CquZIOW4wsBebQqMKZjCgNjZkrfq', 0, NULL, 'edwin.leyton1992@gmail.com', NULL),
('Ashley', 7, 'AshleyL', '$2y$10$6/cS.s0KB7ekMhexl2ZEeeePkpykkvLq99ty80R2X2YrjnSdbLP/S', 0, '$2y$10$hDiLD64oIqS6CHTg37VO6ebumUw8nDsoU2/SmZbxfS1/JJ25hWvse', 0, 1104699403, 'ashleyleyton15@gmail.com', 'fotoPerfil66a5c2c40564d'),
('Ofelia', 8, 'OfeliaM', '$2y$10$Rmusa1U0G7yaNh2RlDz6COMtuAaFZThaR4Otju3tTA95Etod2Z1ku', 0, '$2y$10$giOntvxkbqYNidhYCwO8r.WSWfcZzTI0qRnitYm8//fehPVL6QwNW', 0, 28929053, 'ofeliamontielvera@gmail.com', NULL),
('Marlon', 10, 'Marlon', '$2y$10$t.3HWN1H8c4zV3vQpv8.DutP8CquZIOW4wsBebQqMKZjCgNjZkrfq', 0, '$2y$10$t.3HWN1H8c4zV3vQpv8.DutP8CquZIOW4wsBebQqMKZjCgNjZkrfq', 0, NULL, 'marlon199604@gmail.com', 'fotoPerfil1066a5b55b8f710'),
('123', 21, '123', '$2y$10$4coQ/RONjCYxr/aKsBROoOPLrt9CCqstlUitz5zcxEcWKCm7NAcTq', 0, '$2y$10$djWf0WIYP8u20Ypc4SeXJ.KTl4Z5jcjpqzN8YxKmymn0X8pGeAcoy', 0, 123455789, '123@123.com', NULL),
('Karen', 22, 'Karen', '$2y$10$Dve.90lf0BlblWjS03N8vuTXFkYhmm7ykEas.byPl6EysQWYaBFSi', 0, '$2y$10$8IabPEThOc16KatLWPqiHOEmbCjH07p8otqncTX8IXt1J7BfB.hle', 0, NULL, 'edwin.leyton1992@gmail.com', 'fotoPerfil14');

--
-- Disparadores `usuario`
--
DELIMITER $$
CREATE TRIGGER `before_insert_usuario` BEFORE INSERT ON `usuario` FOR EACH ROW BEGIN



    IF NEW.cedula < 1000000 OR NEW.cedula > 99999999999 THEN



        SIGNAL SQLSTATE '45000'



        SET MESSAGE_TEXT = 'La cédula debe tener entre 7 y 11 dígitos.';



    END IF;



END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `before_update_usuario` BEFORE UPDATE ON `usuario` FOR EACH ROW BEGIN



    IF NEW.cedula < 1000000 OR NEW.cedula > 99999999999 THEN



        SIGNAL SQLSTATE '45000'



        SET MESSAGE_TEXT = 'La cédula debe tener entre 7 y 11 dígitos.';



    END IF;



END
$$
DELIMITER ;

--
-- Índices para tablas volcadas
--

--
-- Indices de la tabla `deudas`
--
ALTER TABLE `deudas`
  ADD PRIMARY KEY (`id_deuda`),
  ADD KEY `id_usuario` (`id_usuario`,`credencial_usuario`);

--
-- Indices de la tabla `ganancias`
--
ALTER TABLE `ganancias`
  ADD PRIMARY KEY (`id_ganancia`),
  ADD UNIQUE KEY `fecha` (`fecha`);

--
-- Indices de la tabla `notificaciones`
--
ALTER TABLE `notificaciones`
  ADD PRIMARY KEY (`id_notificacion`),
  ADD UNIQUE KEY `unique_notificacion` (`id_externo`,`fecha`,`tipo`,`modo`) USING BTREE;

--
-- Indices de la tabla `pagos`
--
ALTER TABLE `pagos`
  ADD PRIMARY KEY (`id_pago`),
  ADD KEY `id_deuda` (`id_deuda`);

--
-- Indices de la tabla `usuario`
--
ALTER TABLE `usuario`
  ADD PRIMARY KEY (`id_usuario`,`credencial_usuario`),
  ADD UNIQUE KEY `unique_cedula` (`cedula`);

--
-- AUTO_INCREMENT de las tablas volcadas
--

--
-- AUTO_INCREMENT de la tabla `deudas`
--
ALTER TABLE `deudas`
  MODIFY `id_deuda` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=131;

--
-- AUTO_INCREMENT de la tabla `ganancias`
--
ALTER TABLE `ganancias`
  MODIFY `id_ganancia` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=59979;

--
-- AUTO_INCREMENT de la tabla `notificaciones`
--
ALTER TABLE `notificaciones`
  MODIFY `id_notificacion` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=4409;

--
-- AUTO_INCREMENT de la tabla `pagos`
--
ALTER TABLE `pagos`
  MODIFY `id_pago` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=386;

--
-- AUTO_INCREMENT de la tabla `usuario`
--
ALTER TABLE `usuario`
  MODIFY `id_usuario` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=23;

--
-- Restricciones para tablas volcadas
--

--
-- Filtros para la tabla `deudas`
--
ALTER TABLE `deudas`
  ADD CONSTRAINT `deudas_ibfk_1` FOREIGN KEY (`id_usuario`,`credencial_usuario`) REFERENCES `usuario` (`id_usuario`, `credencial_usuario`);

--
-- Filtros para la tabla `pagos`
--
ALTER TABLE `pagos`
  ADD CONSTRAINT `pagos_ibfk_1` FOREIGN KEY (`id_deuda`) REFERENCES `deudas` (`id_deuda`);

DELIMITER $$
--
-- Eventos
--
CREATE DEFINER=`root`@`localhost` EVENT `InsertarNotificaciones` ON SCHEDULE EVERY 1 HOUR STARTS '2024-07-31 15:53:55' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN
    -- Insertar registros en la tabla notificaciones usando datos de la tabla deudas
    INSERT INTO notificaciones (id_externo, tipo, estado , estado2, fecha)
    SELECT
        id_deuda,
        0 AS tipo,
        1 AS estado,
        1 AS estado2,
        CURDATE() AS fecha
    FROM deudas
    WHERE fecha_ultimo_interes = CURDATE();
END$$

CREATE DEFINER=`root`@`localhost` EVENT `actualizar_intereses` ON SCHEDULE EVERY 30 MINUTE STARTS '2024-07-05 23:21:22' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN

    UPDATE deudas

    SET

      fecha_ultimo_interes = CURDATE(),

      interes = interes + ((valor_actual * (porcentaje_interes/30))/100)

    WHERE

      fecha_ultimo_interes IS NOT NULL AND

      fecha_ultimo_interes != '0000-00-00' AND

	  estado = 1 AND

      porcentaje_interes > 0 AND

      DATEDIFF(CURDATE(), fecha_ultimo_interes) >= 1;

  END$$

CREATE DEFINER=`root`@`localhost` EVENT `InsertarGanancias` ON SCHEDULE EVERY 61 MINUTE STARTS '2024-09-06 00:00:00' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN
    DECLARE ganancia_diaria DECIMAL(10,2);
    DECLARE ganancia_anterior DECIMAL(10,2) DEFAULT 0; -- Valor por defecto si no hay registro previo
    DECLARE id_ultimo INT;
    DECLARE id_penultimo INT;
    DECLARE conteo_registros INT;

    -- Obtener la ganancia del día
    SELECT SUM(interes) INTO ganancia_diaria
    FROM deudas
    WHERE estado = 1;

    -- Insertar la nueva ganancia del día
    INSERT INTO ganancias (ganancia_del_dia, fecha)
    VALUES (ganancia_diaria, CURDATE());

    -- Obtener el id del último registro
    SET id_ultimo = (SELECT id_ganancia FROM ganancias ORDER BY id_ganancia DESC LIMIT 1);
    
    -- Contar el número total de registros
    SELECT COUNT(*) INTO conteo_registros FROM ganancias;

    -- Verificar si hay más de un registro
    IF conteo_registros > 1 THEN
        -- Obtener el id del penúltimo registro
        SET id_penultimo = (SELECT id_ganancia FROM ganancias WHERE id_ganancia < id_ultimo ORDER BY id_ganancia DESC LIMIT 1);

        -- Obtener la ganancia_del_dia del penúltimo registro
        SELECT ganancia_del_dia INTO ganancia_anterior
        FROM ganancias
        WHERE id_ganancia = id_penultimo;
    END IF;

    -- Actualizar la ganancia_diferencia del último registro
    UPDATE ganancias
    SET ganancia_diferencia = ganancia_diaria - ganancia_anterior
    WHERE id_ganancia = id_ultimo;
END$$

DELIMITER ;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
